---
title: |
  <center> for Applied Educational Research </center>
  <center> Spring 2026 </center>
  <center> Week 3 Data Analytic Memo Starter Code </center>
  <center> S-052: Intermediate and Advanced Statistical Methods </center>
author: "Sara Ji and Bailey Buchanan"
date: "Last Modified: Feb 2026"
output: pdf_document
editor_options: 
  markdown: 
    wrap: 72
---

### RQ: What is the causal effect of technology-led afterschool on math scores?

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load in packages

```{r packages, warning = FALSE, message = FALSE}
# These packages will be helpful for your analysis
library(foreign)    # For reading various data formats
library(haven)      # For reading Stata files
library(tidyverse)  # For data manipulation and visualization
library(stargazer)  # For nice regression tables
require(gridExtra)
# If you haven't installed these packages yet, run:
# install.packages(c("foreign", "haven", "tidyverse", "stargazer"))
```

## Define the working directory and load data

```{r setwd}
# Set your working directory to where your data file is located
# Update the path below to match your file location
setwd("/Users/juhong/Desktop/S052/Data")
```

##Data: Thanks to Prof. Alejandro Ganimian and coauthors Karthik
Muralidharan and Abhijeet Singh for this data

```{r importdata2}
# Load the data
dat <- read_dta("/Users/juhong/Desktop/S052/W3/mindspark_data.dta")
origin <- read_dta("/Users/juhong/Desktop/S052/W3/mindspark_data.dta")
```

## Q1: Exploratory Data Analysis

```{r explore}
# For this question, you will need:
# - The hist() function or ggplot() with geom_histogram() for histograms
# - The summarize() function from dplyr or the summary() function for descriptive statistics
# - You can calculate statistics by group using group_by() and summarize() in dplyr
# - Or use aggregate() or tapply() in base R
# 
# Hint: To get means by groups, you might use something like:
# dat %>%
   # group_by(variable1, variable2) %>%
   # summarize(mean_score = mean(math_std, na.rm = TRUE))

# Before turning to Google, AI, etc., try typing `?function_name` in the console to see documentation
# - Example: `?lm` for help with linear models
```

sum(is.na(dat)) dat \<- drop_na(dat)

dat\$female %\>% table()

head(dat) 413/(124+413)*100 470/(149+470)*100

counts_table \<- table(dat\$female) print(prop.table(counts_table,
margin = 1))

dat %\>% group_by(female, treat) %\>% summarize(mean_score =
mean(math_std,na.rm = TRUE))

### v1: Histogram of math scores on gender and treatment

dat$female_f <- factor(dat$female, levels = c(0, 1), labels = c("Male",
"Female"))

dat$treat_f <- factor(dat$treat, levels = c(0, 1), labels = c("Control",
"Treatment"))

gender_hist \<- ggplot(dat, aes(x = math_std)) + geom_histogram(fill =
"light blue", #Set bar fill color, color = "black") + #Set bar border
color facet_wrap(\~female_f)

treat_hist \<- ggplot(dat, aes(x = math_std)) + geom_histogram(fill =
"light pink", color = "black") + facet_wrap(\~treat_f)

grid.arrange(grobs = list(gender_hist,treat_hist))

ggplot(dat, aes(x = female, y= math_std)) + geom_point(fill = "light
blue", color = "black")

### v2: Histogram per group

f_t \<- dat%\>%filter(female == 1, treat == 1) %\>%
ggplot(aes(x=math_std))+geom_histogram()+ggtitle("Female in Treated")
f_c \<- dat%\>%filter(female == 1, treat == 0) %\>%
ggplot(aes(x=math_std))+geom_histogram()+ggtitle("Female in Controlled")
m_t \<- dat%\>%filter(female == 0, treat == 1) %\>%
ggplot(aes(x=math_std))+geom_histogram()+ggtitle("Male in Treated") m_c
\<- dat%\>%filter(female == 0, treat == 0) %\>%
ggplot(aes(x=math_std))+geom_histogram()+ggtitle("Male in Controlled")

grid.arrange(grobs = list(f_t, f_c, m_t, m_c))

### V3: Histogram of grouped by gender, colored by treat, counts percentaged

f_t_dat \<- dat%\>%filter(female == 1, treat == 1) f_t \<- f_t_dat
%\>%ggplot(aes(x=math_std, y= after_stat(100\*count/
sum(count))))+geom_histogram()+ggtitle("Female in Treated")+ xlim(-5, 5)
f_c \<- dat%\>%filter(female == 1, treat == 0) %\>%
ggplot(aes(x=math_std))+geom_histogram()+ggtitle("Female in
Controlled")+ xlim(-5, 5) m_t \<- dat%\>%filter(female == 0, treat == 1)
%\>% ggplot(aes(x=math_std))+geom_histogram()+ggtitle("Male in
Treated")+ xlim(-5, 5) m_c \<- dat%\>%filter(female == 0, treat == 0)
%\>% ggplot(aes(x=math_std))+geom_histogram()+ggtitle("Male in
Controlled")+ xlim(-5, 5)

grid.arrange(grobs = list(f_t, f_c, m_t, m_c))

### Final version: Histogram grouped by gender, colored by treat

library(dplyr) library(ggplot2) library(gridExtra)

m_all \<- dat %\>% filter(female == 0) %\>% ggplot(aes(x = math_std,
fill = treat_f, group = treat_f)) + \# group by treat geom_histogram(
aes(y = after_stat(100 \* count / sum(count))), \# % within each (male,
treat) position = "identity", alpha = 0.6 ) + ggtitle("Male") +
labs(fill = "Group", y = "Percent for each group")+xlim(-4, 4)+ylim(0,
8)

f_all \<- dat %\>% filter(female == 1) %\>% ggplot(aes(x = math_std,
fill = treat_f, group = treat_f)) + geom_histogram( aes(y =
after_stat(100 \* count / sum(count))), \# % within each (female, treat)
position = "identity", alpha = 0.6 ) + ggtitle("Female") + labs(fill =
"Group", y = "Percent for each group")+xlim(-4, 4)+ylim(0, 8)

grid.arrange(grobs = list(f_all, m_all))

library(e1071)

origin \<- drop_na(origin)

f_t_dat \<- origin%\>%filter(female == 1, treat == 1) f_c_dat \<-
origin%\>%filter(female == 1, treat == 0) m_t_dat \<-
origin%\>%filter(female == 0, treat == 1) m_c_dat \<-
origin%\>%filter(female == 0, treat == 0)

dat %\>% group_by(female, treat) %\>% summarize(skewness =
skewness(math_std,na.rm = TRUE)) dat %\>% group_by(female, treat) %\>%
summarize(mean_score = mean(math_std,na.rm = TRUE)) dat %\>%
group_by(female, treat) %\>% summarize(standard_deviation =
sd(math_std,na.rm = TRUE))

## Q2: Separate and joint estimation of causal effects

```{r causal}
# Convert variables to factors if needed (this helps R handle categorical variables properly)
dat$treat <- as_factor(dat$treat)
dat$female <- as_factor(dat$female)

# For this question, you will need the lm() function for linear regression
# Remember to use robust standard errors!
m_all_dat <- dat %>%filter(female == 0)
# Model 1: Effect for male students only
# Hint: Use filter() or subset to select only male students (female == "0")
# lm(math_std ~ treat, data = ...)
head(m_all_dat)

mod1 <- lm(math_std ~ treat, data = m_all_dat)# Your code here
   
# If you want to see the full model output, including coefficient estimates, standard errors, test statistics, and p-values, call summary(mod).
summary(mod1)

# Model 2: Effect for female students only
f_all_dat <- dat%>%filter(female == 1)
mod2 <- lm(math_std ~ treat, data = f_all_dat)
summary(mod2)

# Model 3: Full model with interaction
# Hint: Use the formula: math_std ~ treat*female
# The * automatically includes main effects and interaction
mod3 <- lm(math_std ~ treat*female, data=dat)
summary(mod3)

# This code will output your regression results into a nice table
# (Similar to esttab in Stata)
stargazer(mod1, mod2, mod3, 
          type = "text",
          column.labels = c("Male", "Female", "Full"),
          title = "...WRITE A TITLE HERE...",
          star.char = c("*", "**", "***"),
          star.cutoffs = c(0.05, 0.01, 0.001),
          notes = c("*p<0.05; **p<0.01; ***p<0.001"),
          notes.append = FALSE)


```

## Coding Pathway
library(dplyr)

########
# Extract coefficients from Model 3
coef_summary <- summary(mod3)$coefficients
intercept <- coef_summary["(Intercept)", "Estimate"]
treat_effect <- coef_summary["treat1", "Estimate"]
female_effect <- coef_summary["female1", "Estimate"]
interaction <- coef_summary["treat1:female1", "Estimate"]

# Create data frame with all 4 estimated values
plot_data <- data.frame(
  group = c("Male Control", "Male Treatment", "Female Control", "Female Treatment"),
  gender = c("Male", "Male", "Female", "Female"),
  treatment = c("Control", "Treatment", "Control", "Treatment"),
  estimate = c(
    intercept,                                    # Male Control
    intercept + treat_effect,                     # Male Treatment
    intercept + female_effect,                    # Female Control
    intercept + treat_effect + female_effect + interaction  # Female Treatment
  ),
  se = c(
    coef_summary["(Intercept)", "Std. Error"],
    sqrt(vcov(mod3)["(Intercept)", "(Intercept)"] + 
         vcov(mod3)["treat1", "treat1"] + 
         2 * vcov(mod3)["(Intercept)", "treat1"]),
    sqrt(vcov(mod3)["(Intercept)", "(Intercept)"] + 
         vcov(mod3)["female1", "female1"] + 
         2 * vcov(mod3)["(Intercept)", "female1"]),
    sqrt(vcov(mod3)["(Intercept)", "(Intercept)"] + 
         vcov(mod3)["treat1", "treat1"] + 
         vcov(mod3)["female1", "female1"] + 
         vcov(mod3)["treat1:female1", "treat1:female1"] +
         2 * vcov(mod3)["(Intercept)", "treat1"] +
         2 * vcov(mod3)["(Intercept)", "female1"] +
         2 * vcov(mod3)["(Intercept)", "treat1:female1"] +
         2 * vcov(mod3)["treat1", "female1"] +
         2 * vcov(mod3)["treat1", "treat1:female1"] +
         2 * vcov(mod3)["female1", "treat1:female1"])
  )
)

# BAR GRAPH showing all 4 values
ggplot(plot_data, aes(x = gender, y = estimate, fill = treatment)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8), alpha = 1) +
  geom_errorbar(aes(ymin = estimate - se, ymax = estimate + se), 
                width = 0.2, 
                position = position_dodge(width = 0.8),
                linewidth = 0.8) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  theme_minimal() +
  labs(
    x = "Gender",
    y = "Standardized Math Score",
    fill = "Treatment"
  ) +
  scale_fill_manual(values = c("Control" = "lightblue", "Treatment" = "pink"))

## Additional Notes for Students:

### Helpful R Tips:

1.  **Filtering data**: Use `filter()` from dplyr

    -   Example: `filter(dat, female == 0)`

2.  **Creating groups**: For analysis by groups, you can:

    -   Use `group_by()` and `summarize()` from dplyr
    -   Use the `by()` function in base R
    -   Filter and analyze separately

3.  **Getting help**: Type `?function_name` in the console to see
    documentation

    -   Example: `?lm` for help with linear models

4.  **Checking your work**: Use `summary()` on your model objects to see
    detailed output

5.  **For the interaction model**: Remember that `treat*female` in the
    formula automatically includes both main effects and the interaction
    term
